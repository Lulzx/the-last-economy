<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ch 11 — The Cathedral and the Bazaar 2.0</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&family=DM+Sans:ital,opsz,wght@0,9..40,100..900;1,9..40,100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
body { background: #fafaf8; color: #1a1a1a; font-family: 'DM Sans', system-ui, sans-serif; margin: 0; }
.prose { max-width: 680px; margin: 0 auto; padding: 2rem 1.5rem; font-family: 'DM Sans', system-ui, sans-serif; line-height: 1.7; font-size: 1.05rem; }
.panel { background: white; border: 1px solid #e5e5e0; border-radius: 8px; padding: 1.5rem; margin: 2rem 0; box-shadow: 0 1px 3px rgba(0,0,0,0.08); opacity: 0; animation: fadeSlideIn 0.5s ease forwards; animation-delay: calc(0.1s * var(--i, 0)); transition: box-shadow 0.2s, transform 0.2s; }
.panel:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.1); transform: translateY(-1px); }
h1 { font-family: 'Playfair Display', Georgia, serif; font-size: clamp(1.8rem, 5vw, 2.6rem); font-weight: 700; margin-bottom: 0.5rem; }
h2 { font-family: 'Playfair Display', Georgia, serif; font-size: 1.3rem; font-weight: 600; margin-top: 2rem; }
.chapter-num { color: #888; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 0.5rem; }
.nav { display: flex; justify-content: space-between; padding: 1rem 1.5rem; border-bottom: 1px solid #e5e5e0; font-size: 0.9rem; position: sticky; top: 0; background: rgba(250,250,248,0.95); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); z-index: 100; }
.nav a { color: #2563eb; text-decoration: none; transition: color 0.15s; }
.nav a:hover { color: #1d4ed8; }
svg text { font-family: 'DM Sans', system-ui, sans-serif; }
.btn { background: #2563eb; color: white; border: none; padding: 0.5rem 1.2rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin: 0.25rem; }
.btn:hover { background: #1d4ed8; }
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
.mind-col { border: 1px solid #e5e5e0; border-radius: 8px; padding: 1.2rem; cursor: pointer; opacity: 0; animation: fadeSlideIn 0.4s ease forwards; }
.mind-col.cathedral { border-top: 3px solid #0891b2; --i: 1; animation-delay: calc(0.1s * var(--i)); }
.mind-col.bazaar { border-top: 3px solid #7c3aed; --i: 2; animation-delay: calc(0.1s * var(--i)); }
.mind-icon { font-size: 2rem; margin-bottom: 0.5rem; }
.mind-title { font-weight: 700; font-size: 1.05rem; margin-bottom: 0.5rem; }
.mind-row { font-size: 0.9rem; color: #555; margin: 0.3rem 0; padding-left: 0.25rem; }
.slider-wrap { margin: 1.5rem 0 0.5rem; }
.slider-label { display: flex; justify-content: space-between; font-size: 0.85rem; color: #555; margin-bottom: 0.4rem; }
input[type="range"] { width: 100%; accent-color: #2563eb; }
.coase-insight { background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 6px; padding: 0.75rem 1rem; font-size: 0.9rem; color: #0c4a6e; margin-top: 1rem; }
.overfit-chart { margin: 1rem 0; }
.example-cards { display: flex; flex-direction: column; gap: 0.5rem; margin-top: 1rem; }
.example-card { border: 1px solid #e5e5e0; border-radius: 6px; padding: 0.75rem 1rem; font-size: 0.9rem; opacity: 0; animation: fadeSlideIn 0.4s ease forwards; }
.example-card:nth-child(1) { --i: 1; animation-delay: calc(0.1s * var(--i)); }
.example-card:nth-child(2) { --i: 2; animation-delay: calc(0.1s * var(--i)); }
.example-card:nth-child(3) { --i: 3; animation-delay: calc(0.1s * var(--i)); }
.example-card .ex-quote { font-style: italic; color: #555; }
.example-card .ex-tag { display: inline-block; font-size: 0.75rem; font-weight: 700; padding: 1px 7px; border-radius: 3px; background: #fee2e2; color: #dc2626; margin-bottom: 0.3rem; }
.sort-area { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; }
.sort-col { border: 2px dashed #e5e5e0; border-radius: 8px; padding: 1rem; min-height: 160px; cursor: pointer; }
.sort-col h3 { font-family: 'Playfair Display', Georgia, serif; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; margin: 0 0 0.75rem; }
.sort-col.cathedral-col { border-color: #0891b2; }
.sort-col.bazaar-col { border-color: #7c3aed; }
.sort-pool { display: flex; flex-direction: column; gap: 0.5rem; margin-top: 1rem; }
.sort-item { background: #f5f5f3; border: 1px solid #e5e5e0; border-radius: 6px; padding: 0.6rem 0.9rem; font-size: 0.88rem; cursor: pointer; transition: background 0.15s; display: flex; justify-content: space-between; align-items: center; }
.sort-item:hover { background: #eeeee9; }
.sort-item.placed { opacity: 0.5; cursor: default; }
.sort-item.active { background: #2563eb; color: white; }
.sort-item .placement-tag { font-size: 0.75rem; font-weight: 700; padding: 1px 6px; border-radius: 3px; }
.reveal-btn-wrap { margin-top: 1rem; }
.reveal-result { margin-top: 0.75rem; display: none; }
.result-row { font-size: 0.88rem; margin: 0.4rem 0; padding: 0.5rem 0.75rem; border-radius: 6px; border: 1px solid #e5e5e0; }
.result-row.surviving { border-color: #16a34a; background: #f0fdf4; }
.result-row.struggling { border-color: #d97706; background: #fffbeb; }
.result-tag { display: inline-block; font-size: 0.75rem; font-weight: 700; padding: 1px 6px; border-radius: 3px; margin-right: 0.4rem; }
.tag-s { background: #dcfce7; color: #16a34a; }
.tag-st { background: #fef3c7; color: #d97706; }

/* --- Enrichment styles --- */
.pullquote { border-left: 5px solid #2563eb; margin: 2rem 0; padding: 1rem 1.5rem; background: #eff6ff; border-radius: 0 8px 8px 0; box-shadow: 0 2px 8px rgba(37,99,235,0.08); }
.pullquote p { font-size: 1.15rem; font-style: italic; color: #1e40af; margin: 0; }
.pullquote .pullquote-attr { font-size: 0.85rem; font-style: normal; color: #555; margin-top: 0.5rem; }
.stat-callout { display: flex; flex-direction: column; align-items: center; padding: 1.5rem; background: white; border: 1px solid #e5e5e0; border-radius: 8px; margin: 1.5rem 0; text-align: center; }
.stat-number { font-family: 'Playfair Display', Georgia, serif; font-size: clamp(1.8rem, 6vw, 3rem); font-weight: 700; color: #2563eb; line-height: 1; }
.stat-label { font-size: 0.9rem; color: #555; margin-top: 0.5rem; }
.stat-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1.5rem 0; }
.section-divider { border: none; height: 1px; background: linear-gradient(90deg, transparent, #e5e5e0 20%, #e5e5e0 80%, transparent); margin: 3rem 0; }
.svg-illustration { display: flex; justify-content: center; margin: 2rem 0; }

@keyframes fadeSlideIn {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 600px) {
  .two-col { grid-template-columns: 1fr; }
  .sort-area { grid-template-columns: 1fr; }
  .stat-row { grid-template-columns: 1fr; }
}

.progress-bar { position: fixed; top: 0; left: 0; height: 3px; background: linear-gradient(90deg, #2563eb, #d97706); z-index: 1000; transition: width 0.1s linear; width: 0%; }

@media (max-width: 640px) {
  .panel-full { margin: 2rem 0; border-radius: 8px; border: 1px solid #e5e5e0; }
  .calc-cols { flex-direction: column; }
  .gauges { grid-template-columns: 1fr !important; }
  .grid-container { grid-template-columns: repeat(4, 44px) !important; }
  .decade-btn { font-size: 0.8rem; padding: 0.3rem 0.6rem; }
  h1 { font-size: clamp(1.6rem, 7vw, 2.2rem); }
  .ratio-display { font-size: 2rem; }
  .stat-number { font-size: clamp(1.8rem, 6vw, 3rem); }
  .year-toggle { flex-wrap: wrap; }
  .year-toggle button { flex: 1; min-width: 80px; }
}

@media (max-width: 480px) {
  .prose { font-size: 1rem; padding: 1.5rem 1rem; }
}
</style>
</head>
<body>
<div class="progress-bar" id="progress-bar"></div>
<nav class="nav">
  <a href="ch5-trial-by-fire.html">&larr; Previous</a>
  <a href="explorables.html">All Chapters</a>
  <a href="ch13-dual-engine.html">Next &rarr;</a>
</nav>

<div class="prose">
  <div class="chapter-num">Chapter 11</div>
  <h1>The Cathedral and the Bazaar 2.0</h1>

  <div class="pullquote">
    <p>"The best way to have a good idea is to have a lot of ideas."</p>
    <div class="pullquote-attr">&mdash; Linus Pauling</div>
  </div>

  <!-- ====== Section: The First Knowledge Workers ====== -->
  <h2>The First Knowledge Workers</h2>

  <p>Before a "computer" was a machine, it was a job title.</p>

  <p>At NASA's Langley Research Center in the 1950s, rooms full of brilliant women, known as "human computers," performed the complex calculations for the space race. They were the original knowledge workers, the human processors at the heart of the most advanced enterprise on Earth. Then, the IBM 7090 arrived. In a single afternoon, the electronic computer could perform more calculations than a human could in a lifetime. The job title of "computer" vanished overnight.</p>

  <!-- SVG: Human Computers to Electronic Computers -->
  <div class="svg-illustration">
    <svg width="400" height="120" viewBox="0 0 400 120" fill="none" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="humanCircleGrad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#e0f2fe"/>
          <stop offset="100%" stop-color="#bae6fd"/>
        </linearGradient>
        <linearGradient id="machineRectGrad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#f0e7ff"/>
          <stop offset="100%" stop-color="#ede9fe"/>
        </linearGradient>
        <filter id="svgShadow1">
          <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.15"/>
        </filter>
        <linearGradient id="bgGradHuman" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#f8fbff"/>
          <stop offset="100%" stop-color="#f0f9ff"/>
        </linearGradient>
      </defs>
      <rect x="0" y="0" width="400" height="120" rx="8" fill="url(#bgGradHuman)" opacity="0.7"/>
      <!-- Human computer side -->
      <circle cx="60" cy="50" r="22" fill="url(#humanCircleGrad)" stroke="#0891b2" stroke-width="2" filter="url(#svgShadow1)"/>
      <circle cx="60" cy="38" r="8" fill="#0891b2" opacity="0.45"/>
      <line x1="60" y1="46" x2="60" y2="65" stroke="#0891b2" stroke-width="2"/>
      <line x1="50" y1="55" x2="70" y2="55" stroke="#0891b2" stroke-width="2"/>
      <text x="60" y="90" text-anchor="middle" font-size="11" fill="#555" font-family="'DM Sans', system-ui, sans-serif">Human Computer</text>
      <text x="60" y="105" text-anchor="middle" font-size="9" fill="#888" font-family="'DM Sans', system-ui, sans-serif">1950s NASA</text>
      <!-- Arrow -->
      <defs>
        <linearGradient id="arrowGrad11" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#0891b2"/>
          <stop offset="100%" stop-color="#2563eb"/>
        </linearGradient>
      </defs>
      <line x1="120" y1="50" x2="270" y2="50" stroke="url(#arrowGrad11)" stroke-width="2" stroke-dasharray="6,4"/>
      <polygon points="270,44 282,50 270,56" fill="#2563eb"/>
      <text x="196" y="40" text-anchor="middle" font-size="10" fill="#2563eb" font-weight="600" font-family="'DM Sans', system-ui, sans-serif">IBM 7090 arrives</text>
      <!-- Electronic computer side -->
      <rect x="298" y="28" width="64" height="44" rx="6" fill="url(#machineRectGrad)" stroke="#7c3aed" stroke-width="2" filter="url(#svgShadow1)"/>
      <rect x="308" y="36" width="44" height="22" rx="3" fill="#7c3aed" opacity="0.18"/>
      <circle cx="315" cy="47" r="2.5" fill="#7c3aed"/>
      <circle cx="323" cy="47" r="2.5" fill="#7c3aed"/>
      <circle cx="331" cy="47" r="2.5" fill="#7c3aed"/>
      <text x="330" y="90" text-anchor="middle" font-size="11" fill="#555" font-family="'DM Sans', system-ui, sans-serif">Electronic Computer</text>
      <text x="330" y="105" text-anchor="middle" font-size="9" fill="#888" font-family="'DM Sans', system-ui, sans-serif">Faster by orders of magnitude</text>
      <!-- Pulsing dot on electronic computer -->
      <circle cx="330" cy="47" r="5" fill="#7c3aed" opacity="0.6">
        <animate attributeName="r" values="5;8;5" dur="2s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0.6;0.2;0.6" dur="2s" repeatCount="indefinite"/>
      </circle>
    </svg>
  </div>

  <p>This story is not just a historical curiosity; it is a preview. The knowledge workers of today, sitting in their open-plan offices, are the direct descendants of those women. And their IBM 7090 has arrived.</p>

  <div class="pullquote">
    <p>To understand the future of the firm, we must first understand the two minds of the economy.</p>
  </div>

  <hr class="section-divider">

  <!-- ====== Section: The Two Minds of the Economy ====== -->
  <h2>The Two Minds of the Economy</h2>

  <p>If the economy is a vast, distributed computer, then it has two different kinds of processors. Two ways of thinking.</p>

  <p>The first is the <strong>Firm.</strong> It is a pocket of planned order in a sea of chaos. It is a hierarchy, a command structure, an island of conscious design. Inside a company, resources flow by a manager's decree. The firm is a cathedral, built according to a deliberate blueprint.</p>

  <p>The second is the <strong>Market.</strong> It is a decentralized network of competing and cooperating agents. It has no leader, no plan, no central command. It is a swarm, a process of emergent discovery. In the market, resources flow by the emergent signals of price and opportunity. It is a bazaar, chaotic and vibrant, where order arises from the bottom up.</p>

  <p>For a century, the great battle of economic ideologies was a battle between these two minds. Both sides were wrong because they thought it was a battle. <strong>It was never a battle. It is a dance.</strong></p>

  <!-- SVG: Cathedral vs Bazaar — enhanced architectural silhouette vs organic network -->
  <div class="svg-illustration">
    <svg width="500" height="220" viewBox="0 0 500 220" fill="none" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="cathedralStoneGrad" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#64748b"/>
          <stop offset="100%" stop-color="#334155"/>
        </linearGradient>
        <linearGradient id="cathedralSkyGrad" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#e0e7ff"/>
          <stop offset="100%" stop-color="#f0f4ff"/>
        </linearGradient>
        <radialGradient id="bazaarNodeGrad" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#f0e7ff"/>
          <stop offset="100%" stop-color="#c4b5fd"/>
        </radialGradient>
        <radialGradient id="bazaarCenterGrad" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#ede9fe"/>
          <stop offset="100%" stop-color="#7c3aed" stop-opacity="0.3"/>
        </radialGradient>
        <filter id="cathedralShadow">
          <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#334155" flood-opacity="0.25"/>
        </filter>
        <filter id="bazaarGlow">
          <feDropShadow dx="0" dy="0" stdDeviation="5" flood-color="#7c3aed" flood-opacity="0.35"/>
        </filter>
        <filter id="nodeShadowCB">
          <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.15"/>
        </filter>
      </defs>

      <!-- Sky background for cathedral side -->
      <rect x="0" y="0" width="240" height="220" rx="10" fill="url(#cathedralSkyGrad)"/>
      <!-- Night background for bazaar side -->
      <rect x="260" y="0" width="240" height="220" rx="10" fill="#1e1b4b" opacity="0.07"/>
      <rect x="260" y="0" width="240" height="220" rx="10" fill="#f5f3ff"/>

      <!-- CATHEDRAL architectural silhouette -->
      <!-- Main body -->
      <rect x="60" y="100" width="120" height="100" fill="url(#cathedralStoneGrad)" filter="url(#cathedralShadow)"/>
      <!-- Central nave arch -->
      <path d="M90,100 L90,60 Q120,30 150,60 L150,100 Z" fill="url(#cathedralStoneGrad)" filter="url(#cathedralShadow)"/>
      <!-- Left tower -->
      <rect x="55" y="80" width="30" height="120" fill="#475569"/>
      <!-- Left spire -->
      <polygon points="55,80 70,45 85,80" fill="#334155"/>
      <!-- Right tower -->
      <rect x="155" y="80" width="30" height="120" fill="#475569"/>
      <!-- Right spire -->
      <polygon points="155,80 170,45 185,80" fill="#334155"/>
      <!-- Center spire -->
      <polygon points="100,60 120,15 140,60" fill="#1e293b"/>
      <!-- Windows: arched -->
      <path d="M108,120 Q120,108 132,120 L132,145 L108,145 Z" fill="#bfdbfe" opacity="0.7"/>
      <rect x="107" y="145" width="26" height="10" fill="#bfdbfe" opacity="0.5"/>
      <!-- Door arch -->
      <path d="M106,200 Q120,180 134,200" fill="#1e293b"/>
      <rect x="106" y="195" width="28" height="5" fill="#1e293b"/>
      <!-- Cathedral label -->
      <text x="120" y="212" text-anchor="middle" font-size="11" fill="#334155" font-weight="700" font-family="'Playfair Display', Georgia, serif">The Cathedral</text>
      <text x="120" y="8" text-anchor="middle" font-size="9" fill="#475569" font-family="'DM Sans', system-ui, sans-serif">Hierarchy &bull; Command &bull; Blueprint</text>

      <!-- Divider -->
      <line x1="248" y1="20" x2="248" y2="200" stroke="#e5e5e0" stroke-width="1.5" stroke-dasharray="5,4"/>
      <text x="249" y="114" text-anchor="middle" font-size="9" fill="#aaa" font-family="'DM Sans', system-ui, sans-serif" transform="rotate(-90 249 114)">vs</text>

      <!-- BAZAAR: organic radial node network -->
      <!-- Outer glow ring -->
      <circle cx="380" cy="110" r="70" fill="#7c3aed" opacity="0.05" filter="url(#bazaarGlow)"/>
      <!-- Connection lines first (drawn behind nodes) -->
      <line x1="380" y1="110" x2="330" y2="65" stroke="#7c3aed" stroke-width="1.5" opacity="0.3"/>
      <line x1="380" y1="110" x2="430" y2="65" stroke="#7c3aed" stroke-width="1.5" opacity="0.3"/>
      <line x1="380" y1="110" x2="440" y2="120" stroke="#7c3aed" stroke-width="1.5" opacity="0.3"/>
      <line x1="380" y1="110" x2="420" y2="165" stroke="#7c3aed" stroke-width="1.5" opacity="0.3"/>
      <line x1="380" y1="110" x2="340" y2="165" stroke="#7c3aed" stroke-width="1.5" opacity="0.3"/>
      <line x1="380" y1="110" x2="320" y2="120" stroke="#7c3aed" stroke-width="1.5" opacity="0.3"/>
      <line x1="330" y1="65" x2="430" y2="65" stroke="#c4b5fd" stroke-width="1" opacity="0.2"/>
      <line x1="430" y1="65" x2="440" y2="120" stroke="#c4b5fd" stroke-width="1" opacity="0.2"/>
      <line x1="440" y1="120" x2="420" y2="165" stroke="#c4b5fd" stroke-width="1" opacity="0.2"/>
      <line x1="420" y1="165" x2="340" y2="165" stroke="#c4b5fd" stroke-width="1" opacity="0.2"/>
      <line x1="340" y1="165" x2="320" y2="120" stroke="#c4b5fd" stroke-width="1" opacity="0.2"/>
      <line x1="320" y1="120" x2="330" y2="65" stroke="#c4b5fd" stroke-width="1" opacity="0.2"/>
      <!-- Peripheral nodes with colorful gradients -->
      <circle cx="330" cy="65" r="12" fill="#fef3c7" stroke="#d97706" stroke-width="2" filter="url(#nodeShadowCB)"/>
      <circle cx="430" cy="65" r="12" fill="#dcfce7" stroke="#059669" stroke-width="2" filter="url(#nodeShadowCB)"/>
      <circle cx="440" cy="120" r="10" fill="#fce7f3" stroke="#db2777" stroke-width="2" filter="url(#nodeShadowCB)"/>
      <circle cx="420" cy="165" r="11" fill="#dbeafe" stroke="#2563eb" stroke-width="2" filter="url(#nodeShadowCB)"/>
      <circle cx="340" cy="165" r="10" fill="#fee2e2" stroke="#dc2626" stroke-width="2" filter="url(#nodeShadowCB)"/>
      <circle cx="320" cy="120" r="12" fill="#f0e7ff" stroke="#7c3aed" stroke-width="2" filter="url(#nodeShadowCB)"/>
      <!-- Center pulsing hub -->
      <circle cx="380" cy="110" r="22" fill="url(#bazaarCenterGrad)" stroke="#7c3aed" stroke-width="2.5" filter="url(#bazaarGlow)">
        <animate attributeName="r" values="22;25;22" dur="3s" repeatCount="indefinite"/>
      </circle>
      <circle cx="380" cy="110" r="10" fill="#7c3aed" opacity="0.7"/>
      <!-- Bazaar label -->
      <text x="380" y="212" text-anchor="middle" font-size="11" fill="#5b21b6" font-weight="700" font-family="'Playfair Display', Georgia, serif">The Bazaar</text>
      <text x="380" y="8" text-anchor="middle" font-size="9" fill="#6d28d9" font-family="'DM Sans', system-ui, sans-serif">Network &bull; Discovery &bull; Emergence</text>
    </svg>
  </div>

  <div class="panel" style="--i: 1;">
    <h2>The Two Minds</h2>
    <div class="two-col">
      <div class="mind-col cathedral">
        <div class="mind-icon">&#x1F3DB;</div>
        <div class="mind-title">The Cathedral</div>
        <div style="font-size:0.85rem;color:#888;margin-bottom:0.75rem;">Firm / Hierarchy</div>
        <div class="mind-row">Command &amp; Control</div>
        <div class="mind-row">Plans &rarr; Executes</div>
        <div class="mind-row">Exploit known solutions</div>
        <div class="mind-row">Coase: internalize transactions</div>
      </div>
      <div class="mind-col bazaar">
        <div class="mind-icon">&#x1F3EA;</div>
        <div class="mind-title">The Bazaar</div>
        <div style="font-size:0.85rem;color:#888;margin-bottom:0.75rem;">Market / Network</div>
        <div class="mind-row">Distributed Discovery</div>
        <div class="mind-row">Explores &rarr; Emerges</div>
        <div class="mind-row">Explore unknown possibilities</div>
        <div class="mind-row">Price signals coordinate</div>
      </div>
    </div>

    <div class="slider-wrap">
      <div class="slider-label">
        <span style="color:#7c3aed;font-weight:600;">&#8592; Low Transaction Cost (Bazaar wins)</span>
        <span style="color:#0891b2;font-weight:600;">High Transaction Cost (Cathedral wins) &#8594;</span>
      </div>
      <input type="range" id="tc-slider" min="0" max="100" value="50" oninput="updateTCViz()">
    </div>

    <svg id="tc-viz" style="width:100%;max-width:600px;" height="80"></svg>

    <div class="coase-insight" id="coase-text">
      The Coase Insight: the firm exists where the cost of organizing via the market (finding, contracting, monitoring) exceeds the cost of employing directly. AI slashes both costs simultaneously — and the boundary between firm and market dissolves.
    </div>
  </div>

  <hr class="section-divider">

  <!-- ====== Section: A New Answer for a New Age ====== -->
  <h2>A New Answer for a New Age</h2>

  <p>In 1937, Ronald Coase asked why firms exist at all. His answer was <strong>transaction costs</strong>: the friction of using the market. A firm is a bubble of hierarchy where the messy haggling of the market is replaced by the simpler logic of command. This was a brilliant insight for the old economy of atoms. The new economy of bits requires a deeper explanation.</p>

  <p>In the framework of Intelligent Economics, the firm and the market are different architectures for processing information.</p>

  <div class="stat-row">
    <div class="stat-callout">
      <div class="stat-number">II</div>
      <div class="stat-label">Processing architectures in any economy: the Market (parallel) and the Firm (serial)</div>
    </div>
    <div class="stat-callout">
      <div class="stat-number">1937</div>
      <div class="stat-label">Year Coase published "The Nature of the Firm"</div>
    </div>
  </div>

  <div class="pullquote">
    <p>The Market is a massively parallel, distributed computing system. It is brilliant at exploring a vast possibility space. The market is an engine for discovery.</p>
  </div>

  <p>The Firm is a serial, hierarchical computing system. It is designed to take a single, promising idea discovered in the market and exploit it with ruthless efficiency. It concentrates intelligence on a narrow problem. The firm is an engine for execution.</p>

  <p><strong>The market discovers. The firm executes. A healthy economy needs both.</strong></p>

  <!-- SVG: Market (parallel) vs Firm (serial) processing -->
  <div class="svg-illustration">
    <svg width="440" height="170" viewBox="0 0 440 170" fill="none" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="marketBg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#f5f3ff"/>
          <stop offset="100%" stop-color="#ede9fe"/>
        </linearGradient>
        <linearGradient id="firmBg" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#e0f2fe"/>
          <stop offset="100%" stop-color="#bae6fd"/>
        </linearGradient>
        <filter id="parallelShadow">
          <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.15"/>
        </filter>
      </defs>
      <rect x="0" y="0" width="440" height="170" rx="8" fill="#fafaf8" opacity="0.7"/>
      <!-- Market: parallel paths -->
      <text x="110" y="16" text-anchor="middle" font-size="12" fill="#7c3aed" font-weight="600" font-family="'DM Sans', system-ui, sans-serif">Market: Parallel Discovery</text>
      <circle cx="30" cy="90" r="14" fill="url(#marketBg)" stroke="#7c3aed" stroke-width="2" filter="url(#parallelShadow)"/>
      <text x="30" y="94" text-anchor="middle" font-size="8" fill="#7c3aed" font-family="'DM Sans', system-ui, sans-serif">IN</text>
      <!-- Multiple parallel lines with varying opacity to show divergence -->
      <line x1="44" y1="75" x2="168" y2="38" stroke="#7c3aed" stroke-width="1.5" opacity="0.4"/>
      <line x1="44" y1="82" x2="168" y2="65" stroke="#7c3aed" stroke-width="1.5" opacity="0.55"/>
      <line x1="44" y1="90" x2="168" y2="90" stroke="#7c3aed" stroke-width="2" opacity="0.75"/>
      <line x1="44" y1="98" x2="168" y2="115" stroke="#7c3aed" stroke-width="1.5" opacity="0.55"/>
      <line x1="44" y1="105" x2="168" y2="142" stroke="#7c3aed" stroke-width="1.5" opacity="0.4"/>
      <!-- Nodes at end -->
      <circle cx="175" cy="38" r="6" fill="#7c3aed" opacity="0.35" filter="url(#parallelShadow)"/>
      <circle cx="175" cy="65" r="6" fill="#7c3aed" opacity="0.5" filter="url(#parallelShadow)"/>
      <circle cx="175" cy="90" r="9" fill="#7c3aed" opacity="0.85" filter="url(#parallelShadow)"/>
      <circle cx="175" cy="115" r="6" fill="#7c3aed" opacity="0.5" filter="url(#parallelShadow)"/>
      <circle cx="175" cy="142" r="6" fill="#7c3aed" opacity="0.35" filter="url(#parallelShadow)"/>
      <text x="110" y="162" text-anchor="middle" font-size="9" fill="#888" font-family="'DM Sans', system-ui, sans-serif">Many paths explored simultaneously</text>

      <!-- Divider -->
      <line x1="220" y1="25" x2="220" y2="150" stroke="#e5e5e0" stroke-width="1" stroke-dasharray="4,3"/>

      <!-- Firm: serial path -->
      <text x="340" y="16" text-anchor="middle" font-size="12" fill="#0891b2" font-weight="600" font-family="'DM Sans', system-ui, sans-serif">Firm: Serial Execution</text>
      <circle cx="260" cy="90" r="14" fill="url(#firmBg)" stroke="#0891b2" stroke-width="2" filter="url(#parallelShadow)"/>
      <text x="260" y="94" text-anchor="middle" font-size="8" fill="#0891b2" font-family="'DM Sans', system-ui, sans-serif">IN</text>
      <line x1="274" y1="90" x2="302" y2="90" stroke="#0891b2" stroke-width="2.5"/>
      <rect x="302" y="79" width="22" height="22" rx="4" fill="#0891b2" opacity="0.2" stroke="#0891b2" stroke-width="1.5" filter="url(#parallelShadow)"/>
      <line x1="324" y1="90" x2="348" y2="90" stroke="#0891b2" stroke-width="2.5"/>
      <rect x="348" y="79" width="22" height="22" rx="4" fill="#0891b2" opacity="0.35" stroke="#0891b2" stroke-width="1.5" filter="url(#parallelShadow)"/>
      <line x1="370" y1="90" x2="394" y2="90" stroke="#0891b2" stroke-width="2.5"/>
      <rect x="394" y="79" width="22" height="22" rx="4" fill="#0891b2" opacity="0.55" stroke="#0891b2" stroke-width="1.5" filter="url(#parallelShadow)"/>
      <polygon points="418,83 428,90 418,97" fill="#0891b2"/>
      <text x="344" y="128" text-anchor="middle" font-size="9" fill="#888" font-family="'DM Sans', system-ui, sans-serif">One path refined with focus</text>
      <text x="344" y="145" text-anchor="middle" font-size="9" fill="#888" font-family="'DM Sans', system-ui, sans-serif">Ruthless efficiency on a narrow problem</text>
    </svg>
  </div>

  <hr class="section-divider">

  <!-- ====== Section: Ghosts of a Frictionless World ====== -->
  <h2>The Ghosts of a Frictionless World</h2>

  <p>The old economics was haunted by beautiful theories that only worked in a perfect, frictionless world. The Coase Theorem argued that in a world with zero transaction costs, property rights do not matter. The Modigliani-Miller Theorem argued that in a perfect market, a firm's mix of debt and equity does not matter.</p>

  <p>These elegant proofs fail in the real world for the same geometric reason. They assume a flat, frictionless economic manifold. On such a surface, all paths are direct and costless. In the real, curved world, these choices are fundamental acts of topology engineering.</p>

  <div class="pullquote">
    <p>Assigning a property right is not a starting position in the game; it is the design of the game board itself.</p>
  </div>

  <p>A firm's capital structure is not a simple financing choice; it is a choice about its navigability on a volatile landscape. Debt creates geometric rigidity &mdash; it locks the firm into a fixed path, making it fast but brittle. Equity provides geometric flexibility &mdash; it acts as a ballast, allowing the firm to absorb shocks. These are not imperfections in a perfect model. They are the central, strategic negotiations with the geometry of reality.</p>

  <hr class="section-divider">

  <!-- ====== Section: The Innovator's Dilemma ====== -->
  <h2>The Innovator's Dilemma: When Execution Kills Discovery</h2>

  <p>This brings us to the great tragedy of the intelligent firm. The very qualities that make it a brilliant execution engine also make it a terrible discovery engine. The firm's success creates an algorithm optimized for solving a specific problem. But when the problem changes, that finely tuned algorithm becomes a cage.</p>

  <p>In the 1970s, Xerox PARC invented the modern personal computer, the graphical user interface, the mouse, and the Ethernet. They invented the future. Their parent company, Xerox, ignored all of it. Why? The Xerox Corporation was an execution engine perfectly optimized for leasing copiers and selling toner. The personal computer did not fit their model. It was a prediction error they could not process. So they let a young man named Steve Jobs take their ideas for free and build Apple.</p>

  <div class="pullquote">
    <p>Xerox's execution engine was so perfect it executed itself.</p>
  </div>

  <p>In machine learning, this is called <strong>"overfitting."</strong> A model trained too perfectly on past data becomes brittle, incapable of handling a future that looks even slightly different. Successful firms are masters of overfitting.</p>

  <div class="panel" style="--i: 2;">
    <h2>The Overfitting Trap</h2>
    <p style="font-size:0.9rem;color:#555;">Firms are trained on competitive environments. The best firms become perfectly adapted to their environment — and perfectly unable to adapt to a new one. This is overfitting: high accuracy on the training set, catastrophic failure on new data.</p>

    <div class="overfit-chart">
      <svg id="overfit-svg" style="width:100%;max-width:600px;" height="160"></svg>
    </div>

    <div class="example-cards">
      <div class="example-card">
        <div class="ex-tag">OVERFITTED</div>
        <div>"Xerox PARC invented the personal computer, the graphical interface, Ethernet, and the laser printer. Then couldn't commercialize any of them." — Overfitted to copier leasing.</div>
      </div>
      <div class="example-card">
        <div class="ex-tag">OVERFITTED</div>
        <div>"Kodak invented the digital camera in 1975 — then filed for bankruptcy in 2012." — Overfitted to chemical film margins.</div>
      </div>
      <div class="example-card">
        <div class="ex-tag">OVERFITTED</div>
        <div>"Nokia held 40% of the global phone market in 2007. By 2013, its handset division was sold to Microsoft." — Overfitted to hardware manufacturing.</div>
      </div>
    </div>
  </div>

  <hr class="section-divider">

  <!-- ====== Section: The Final Form ====== -->
  <h2>The Final Form: From Corporation to Community</h2>

  <p>The traditional firm, a hierarchical pyramid of human components, is an evolutionary dead end. This is the "slow AI" we have been building for centuries. The Factory School was the brilliant, terrifying system designed to produce the standardized, compliant human fuel for this corporate machine. The school trained the cogs; the corporation put them to work. It was a perfect, self-reinforcing system of social domestication. And it is now obsolete.</p>

  <p>The future belongs to a new kind of institution that blurs the line between the firm and the market, the cathedral and the bazaar. It is an architecture that combines the execution focus of the firm with the discovery power of the market. <strong>A community.</strong></p>

  <!-- SVG: Evolution from Corporation to Community — enhanced with gradients and depth -->
  <div class="svg-illustration">
    <svg width="480" height="165" viewBox="0 0 480 165" fill="none" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <linearGradient id="pyramidFill" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" stop-color="#fee2e2"/>
          <stop offset="100%" stop-color="#fca5a5"/>
        </linearGradient>
        <radialGradient id="networkNodeGreen11" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#bbf7d0"/>
          <stop offset="100%" stop-color="#059669" stop-opacity="0.5"/>
        </radialGradient>
        <filter id="corpShadow11">
          <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.15"/>
        </filter>
        <linearGradient id="bgFade11" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#fff5f5"/>
          <stop offset="50%" stop-color="#fafaf8"/>
          <stop offset="100%" stop-color="#f0fdf4"/>
        </linearGradient>
      </defs>
      <rect x="0" y="0" width="480" height="165" rx="8" fill="url(#bgFade11)"/>

      <!-- Old: Pyramid -->
      <text x="82" y="15" text-anchor="middle" font-size="11" fill="#dc2626" font-weight="600" font-family="'DM Sans', system-ui, sans-serif">Corporation (Pyramid)</text>
      <polygon points="82,30 18,118 146,118" fill="url(#pyramidFill)" stroke="#dc2626" stroke-width="1.5" opacity="0.7" filter="url(#corpShadow11)"/>
      <circle cx="82" cy="50" r="6" fill="#dc2626" opacity="0.8"/>
      <circle cx="62" cy="78" r="5" fill="#dc2626" opacity="0.5"/>
      <circle cx="102" cy="78" r="5" fill="#dc2626" opacity="0.5"/>
      <circle cx="40" cy="104" r="4" fill="#dc2626" opacity="0.3"/>
      <circle cx="65" cy="104" r="4" fill="#dc2626" opacity="0.3"/>
      <circle cx="90" cy="104" r="4" fill="#dc2626" opacity="0.3"/>
      <circle cx="115" cy="104" r="4" fill="#dc2626" opacity="0.3"/>
      <text x="82" y="136" text-anchor="middle" font-size="9" fill="#888" font-family="'DM Sans', system-ui, sans-serif">Hierarchical. Rigid.</text>
      <text x="82" y="150" text-anchor="middle" font-size="9" fill="#888" font-family="'DM Sans', system-ui, sans-serif">Evolutionary dead end.</text>

      <!-- Arrow with gradient -->
      <defs>
        <linearGradient id="arrowGrad11b" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#dc2626"/>
          <stop offset="100%" stop-color="#059669"/>
        </linearGradient>
      </defs>
      <line x1="168" y1="75" x2="280" y2="75" stroke="url(#arrowGrad11b)" stroke-width="2" stroke-dasharray="6,4"/>
      <polygon points="280,69 292,75 280,81" fill="#059669"/>
      <text x="230" y="63" text-anchor="middle" font-size="10" fill="#555" font-weight="600" font-family="'DM Sans', system-ui, sans-serif">Evolves into</text>

      <!-- New: Network/Community — glowing hub-and-spoke -->
      <text x="380" y="15" text-anchor="middle" font-size="11" fill="#059669" font-weight="600" font-family="'DM Sans', system-ui, sans-serif">Community (Network)</text>
      <!-- Center glow -->
      <circle cx="380" cy="75" r="20" fill="#059669" opacity="0.1">
        <animate attributeName="r" values="20;24;20" dur="3.5s" repeatCount="indefinite"/>
      </circle>
      <circle cx="380" cy="75" r="8" fill="url(#networkNodeGreen11)" stroke="#059669" stroke-width="2" filter="url(#corpShadow11)"/>
      <!-- Spokes -->
      <circle cx="340" cy="48" r="6" fill="url(#networkNodeGreen11)" stroke="#059669" stroke-width="1.5" filter="url(#corpShadow11)"/>
      <circle cx="420" cy="48" r="6" fill="url(#networkNodeGreen11)" stroke="#059669" stroke-width="1.5" filter="url(#corpShadow11)"/>
      <circle cx="328" cy="90" r="6" fill="url(#networkNodeGreen11)" stroke="#059669" stroke-width="1.5" filter="url(#corpShadow11)"/>
      <circle cx="432" cy="90" r="6" fill="url(#networkNodeGreen11)" stroke="#059669" stroke-width="1.5" filter="url(#corpShadow11)"/>
      <circle cx="356" cy="115" r="5.5" fill="url(#networkNodeGreen11)" stroke="#059669" stroke-width="1.5"/>
      <circle cx="404" cy="115" r="5.5" fill="url(#networkNodeGreen11)" stroke="#059669" stroke-width="1.5"/>
      <!-- Connection lines -->
      <line x1="380" y1="75" x2="340" y2="48" stroke="#059669" stroke-width="1.2" opacity="0.45"/>
      <line x1="380" y1="75" x2="420" y2="48" stroke="#059669" stroke-width="1.2" opacity="0.45"/>
      <line x1="380" y1="75" x2="328" y2="90" stroke="#059669" stroke-width="1.2" opacity="0.45"/>
      <line x1="380" y1="75" x2="432" y2="90" stroke="#059669" stroke-width="1.2" opacity="0.45"/>
      <line x1="340" y1="48" x2="328" y2="90" stroke="#059669" stroke-width="1" opacity="0.25"/>
      <line x1="420" y1="48" x2="432" y2="90" stroke="#059669" stroke-width="1" opacity="0.25"/>
      <line x1="356" y1="115" x2="328" y2="90" stroke="#059669" stroke-width="1" opacity="0.25"/>
      <line x1="404" y1="115" x2="432" y2="90" stroke="#059669" stroke-width="1" opacity="0.25"/>
      <line x1="356" y1="115" x2="404" y2="115" stroke="#059669" stroke-width="1" opacity="0.2"/>
      <text x="380" y="140" text-anchor="middle" font-size="9" fill="#888" font-family="'DM Sans', system-ui, sans-serif">Distributed. Adaptive.</text>
      <text x="380" y="154" text-anchor="middle" font-size="9" fill="#888" font-family="'DM Sans', system-ui, sans-serif">Symbiotic intelligence.</text>
    </svg>
  </div>

  <p>Consider <strong>Linux</strong>. Is it a firm or a market? It is both and neither. It has a core group of maintainers who provide hierarchical control (like a firm), but it is developed by a global network of volunteers operating in a decentralized bazaar (like a market).</p>

  <p>Or consider <strong>Wikipedia</strong>. It has a foundation that acts like a firm, managing servers and legal issues. But the content itself is created by a chaotic, distributed market of millions of editors.</p>

  <p>These are the new models. They are not a rigid choice between firm and market, but a fluid dance between them. They are architectures for symbiotic intelligence.</p>

  <div class="pullquote">
    <p>The traditional, hierarchical firm tried to create a single, unified "corporate consciousness" &mdash; a top-down cathedral of thought. But real intelligence, both in our brains and in our economies, is more like a bazaar: a chaotic, parallel process of discovery from which a fragile, temporary coherence emerges.</p>
  </div>

  <p>The legacy corporations are like the dinosaurs: large, powerful, and running on a tiny, centralized brain. The new symbiotic communities are like the mammals that succeeded them: smaller, more adaptable, and with a new, more distributed and powerful form of intelligence. We know how that story ended. It is about to begin again.</p>

  <div class="panel" style="--i: 3;">
    <h2>The New Synthesis</h2>
    <p style="font-size:0.9rem;color:#555;">Click each organization to sort it into Cathedral or Bazaar. Then reveal which mode is thriving in the AI age.</p>

    <div id="sort-pool" class="sort-pool"></div>

    <div class="sort-area">
      <div class="sort-col cathedral-col" id="col-cathedral">
        <h3 style="color:#0891b2;">Cathedral</h3>
        <div id="cathedral-items"></div>
      </div>
      <div class="sort-col bazaar-col" id="col-bazaar">
        <h3 style="color:#7c3aed;">Bazaar</h3>
        <div id="bazaar-items"></div>
      </div>
    </div>

    <div class="reveal-btn-wrap">
      <button class="btn" onclick="revealResults()">Reveal AI-Age Outcomes</button>
    </div>
    <div class="reveal-result" id="reveal-result"></div>
  </div>

</div>

<script>
// --- Transaction Cost Slider ---
function updateTCViz() {
  const val = parseInt(document.getElementById('tc-slider').value);
  const svgEl = document.getElementById('tc-viz');
  const w = svgEl.clientWidth || 600;
  const h = 80;
  const svg = d3.select('#tc-viz');
  svg.selectAll('*').remove();

  // Gradient background
  const defs = svg.append('defs');
  const grad = defs.append('linearGradient').attr('id', 'tc-grad').attr('x1', '0%').attr('x2', '100%');
  grad.append('stop').attr('offset', '0%').attr('stop-color', '#7c3aed').attr('stop-opacity', 0.12);
  grad.append('stop').attr('offset', '100%').attr('stop-color', '#0891b2').attr('stop-opacity', 0.12);
  svg.append('rect').attr('width', w).attr('height', h).attr('fill', 'url(#tc-grad)').attr('rx', 4);

  // Boundary line
  const bx = (val / 100) * w;
  svg.append('line').attr('x1', bx).attr('y1', 0).attr('x2', bx).attr('y2', h)
    .attr('stroke', '#1a1a1a').attr('stroke-width', 2).attr('stroke-dasharray', '4,3');

  // Labels
  svg.append('text').attr('x', bx / 2).attr('y', h / 2 + 5)
    .attr('text-anchor', 'middle').attr('font-size', 12).attr('fill', '#7c3aed').attr('font-weight', 600)
    .attr('font-family', "'DM Sans', system-ui, sans-serif")
    .text('Bazaar Territory');

  if (w - bx > 60) {
    svg.append('text').attr('x', bx + (w - bx) / 2).attr('y', h / 2 + 5)
      .attr('text-anchor', 'middle').attr('font-size', 12).attr('fill', '#0891b2').attr('font-weight', 600)
      .attr('font-family', "'DM Sans', system-ui, sans-serif")
      .text('Cathedral Territory');
  }

  // Boundary label
  svg.append('text').attr('x', bx).attr('y', 14)
    .attr('text-anchor', 'middle').attr('font-size', 10).attr('fill', '#555')
    .attr('font-family', "'DM Sans', system-ui, sans-serif")
    .text('Firm boundary');

  const coase = document.getElementById('coase-text');
  if (val < 30) {
    coase.textContent = 'Low transaction costs: Markets beat firms. Platforms, DAOs, and open-source communities outcompete vertically integrated corporations. The bazaar wins.';
  } else if (val > 70) {
    coase.textContent = 'High transaction costs: Firms beat markets. Complex coordination requires planning, trust, and authority. The cathedral wins.';
  } else {
    coase.textContent = 'The Coase Insight: the firm exists where the cost of organizing via the market exceeds the cost of employing directly. AI slashes both costs simultaneously \u2014 and the boundary between firm and market dissolves.';
  }
}

// Init TC viz
requestAnimationFrame(() => updateTCViz());

// --- Overfitting chart ---
requestAnimationFrame(() => {
  const svgEl = document.getElementById('overfit-svg');
  const w = svgEl.clientWidth || 600;
  const h = 160;
  const svg = d3.select('#overfit-svg').attr('height', h);

  // Training data points
  const pts = [
    {x:0.05,y:0.3},{x:0.15,y:0.55},{x:0.25,y:0.4},{x:0.35,y:0.65},
    {x:0.45,y:0.5},{x:0.55,y:0.7},{x:0.65,y:0.6},{x:0.75,y:0.8},
    {x:0.85,y:0.7},{x:0.95,y:0.85}
  ];

  const xS = d3.scaleLinear().domain([0,1]).range([20, w-20]);
  const yS = d3.scaleLinear().domain([0,1]).range([h-15, 15]);

  // Generalize line (smooth)
  const genData = d3.range(0, 1.01, 0.05).map(x => ({x, y: 0.3 + x * 0.6}));
  const genLine = d3.line().x(d => xS(d.x)).y(d => yS(d.y)).curve(d3.curveBasis);
  svg.append('path').datum(genData).attr('d', genLine)
    .attr('fill','none').attr('stroke','#16a34a').attr('stroke-width',2.5).attr('opacity',0.8);
  svg.append('text').attr('x', w - 22).attr('y', yS(0.3 + 0.6) - 8)
    .attr('font-size',10).attr('fill','#16a34a').attr('text-anchor','end')
    .attr('font-family', "'DM Sans', system-ui, sans-serif")
    .text('Adaptive Newcomer');

  // Overfit line (wiggly - passes through all pts)
  const overData = d3.range(0, 1.01, 0.02).map(x => {
    const base = 0.3 + x * 0.6;
    const wiggle = 0.15 * Math.sin(x * Math.PI * 8) * Math.pow(x, 0.3);
    return {x, y: base + wiggle};
  });
  const overLine = d3.line().x(d => xS(d.x)).y(d => yS(Math.max(0.05, Math.min(0.95, d.y)))).curve(d3.curveBasis);
  svg.append('path').datum(overData).attr('d', overLine)
    .attr('fill','none').attr('stroke','#dc2626').attr('stroke-width',2).attr('stroke-dasharray','5,3').attr('opacity',0.7);
  svg.append('text').attr('x', xS(0.5)).attr('y', 12)
    .attr('font-size',10).attr('fill','#dc2626').attr('text-anchor','middle')
    .attr('font-family', "'DM Sans', system-ui, sans-serif")
    .text('Incumbent (overfitted to old reality)');

  // Data points
  svg.selectAll('.pt').data(pts).join('circle').attr('class','pt')
    .attr('cx', d => xS(d.x)).attr('cy', d => yS(d.y)).attr('r', 4)
    .attr('fill','#2563eb').attr('opacity',0.7);

  // Label
  svg.append('text').attr('x', xS(0.05)).attr('y', h - 3)
    .attr('font-size',9).attr('fill','#888')
    .attr('font-family', "'DM Sans', system-ui, sans-serif")
    .text('Time / Environmental Change \u2192');
});

// --- Sort Game ---
const orgs = [
  { name: 'Traditional Corporation', correct: 'cathedral', ai: 'struggling', reason: 'Hierarchical decisions too slow for AI-speed markets' },
  { name: 'Linux Foundation', correct: 'bazaar', ai: 'surviving', reason: 'Distributed contribution model scales with AI tooling' },
  { name: 'Wikipedia', correct: 'bazaar', ai: 'surviving', reason: 'Knowledge commons model becomes more valuable in AI era' },
  { name: 'Amazon Web Services', correct: 'cathedral', ai: 'surviving', reason: 'Platform infrastructure becomes more critical, not less' },
  { name: 'DAO (Decentralized Autonomous Org)', correct: 'bazaar', ai: 'surviving', reason: 'AI-legible rules and smart contracts fit the new paradigm' },
  { name: 'Apple App Store', correct: 'both', ai: 'struggling', reason: 'Hybrid model faces regulatory pressure and open alternatives' }
];

const placements = {};
let selected = null;

function renderPool() {
  const pool = document.getElementById('sort-pool');
  pool.innerHTML = '';
  orgs.forEach((org, i) => {
    if (placements[i]) return;
    const div = document.createElement('div');
    div.className = 'sort-item' + (selected === i ? ' active' : '');
    div.id = 'pool-' + i;
    div.onclick = () => selectItem(i);
    div.innerHTML = '<span>' + org.name + '</span> <span style="font-size:0.8rem;color:' + (selected === i ? 'rgba(255,255,255,0.7)' : '#888') + ';">click to select</span>';
    pool.appendChild(div);
  });
}

function selectItem(i) {
  selected = i;
  renderPool();
}

function placeIn(col) {
  if (selected === null) return;
  placements[selected] = col;
  const colEl = document.getElementById(col + '-items');
  const div = document.createElement('div');
  div.style.cssText = 'padding:0.4rem 0.6rem;background:#f5f5f3;border:1px solid #e5e5e0;border-radius:5px;font-size:0.85rem;margin-bottom:0.4rem;';
  div.textContent = orgs[selected].name;
  colEl.appendChild(div);
  selected = null;
  renderPool();
}

document.getElementById('col-cathedral').addEventListener('click', () => placeIn('col-cathedral'));
document.getElementById('col-bazaar').addEventListener('click', () => placeIn('col-bazaar'));

// Add click-to-column buttons
const sortArea = document.querySelector('.sort-area');
const btnRow = document.createElement('div');
btnRow.style.cssText = 'display:flex;gap:0.5rem;margin-bottom:0.75rem;align-items:center;flex-wrap:wrap;';
btnRow.innerHTML = '<span style="font-size:0.85rem;color:#555;">After selecting an item, place it:</span> <button class="btn" style="background:#0891b2;font-size:0.8rem;padding:0.3rem 0.8rem;" onclick="placeIn(\'col-cathedral\')">Place in Cathedral</button> <button class="btn" style="background:#7c3aed;font-size:0.8rem;padding:0.3rem 0.8rem;" onclick="placeIn(\'col-bazaar\')">Place in Bazaar</button>';
sortArea.parentElement.insertBefore(btnRow, sortArea);

renderPool();

function revealResults() {
  const resultDiv = document.getElementById('reveal-result');
  resultDiv.style.display = 'block';
  let html = '<div style="font-size:0.9rem;font-weight:600;margin-bottom:0.75rem;">AI-Age Outcomes:</div>';
  orgs.forEach(org => {
    const cls = org.ai === 'surviving' ? 'surviving' : 'struggling';
    const tag = org.ai === 'surviving' ? '<span class="result-tag tag-s">THRIVING</span>' : '<span class="result-tag tag-st">PRESSURE</span>';
    html += '<div class="result-row ' + cls + '">' + tag + '<strong>' + org.name + '</strong> \u2014 ' + org.reason + '</div>';
  });
  resultDiv.innerHTML = html;
}

// Reading progress
window.addEventListener('scroll', function() {
  var p = document.documentElement;
  var pct = p.scrollTop / (p.scrollHeight - p.clientHeight) * 100;
  document.getElementById('progress-bar').style.width = pct + '%';
});
</script>
</body>
</html>
