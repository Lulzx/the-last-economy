<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Symbioism: The Last Economy — Explorable Explanations</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: #fafaf8;
  color: #1a1a1a;
  font-family: system-ui, -apple-system, sans-serif;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

.prose {
  font-family: Georgia, 'Times New Roman', serif;
  max-width: 680px;
  margin: 0 auto;
  line-height: 1.75;
}

header {
  text-align: center;
  padding: 80px 24px 48px;
}

header h1 {
  font-family: system-ui, -apple-system, sans-serif;
  font-size: clamp(1.6rem, 4vw, 2.4rem);
  font-weight: 700;
  letter-spacing: -0.02em;
  margin-bottom: 8px;
}

header .subtitle {
  font-family: system-ui, -apple-system, sans-serif;
  font-size: clamp(0.95rem, 2vw, 1.15rem);
  color: #555;
  margin-bottom: 32px;
}

header .intro {
  font-size: 1.05rem;
  color: #333;
}

.scrub {
  border-bottom: 2px dashed #2563eb;
  cursor: ew-resize;
  color: #2563eb;
  font-weight: 600;
  padding: 0 2px;
  user-select: none;
  -webkit-user-select: none;
  display: inline;
  touch-action: none;
}
.scrub:hover {
  background: rgba(37, 99, 235, 0.08);
}

.grid-section {
  max-width: 1080px;
  margin: 0 auto;
  padding: 24px 24px 80px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
}

@media (max-width: 900px) {
  .grid { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 560px) {
  .grid { grid-template-columns: 1fr; }
  header { padding: 48px 20px 32px; }
}

.card {
  background: #fff;
  border: 1px solid #e5e5e0;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  display: flex;
  flex-direction: column;
  text-decoration: none;
  color: inherit;
  position: relative;
}
.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
}

.card-accent {
  width: 100%;
  height: 4px;
}

.card-viz {
  height: 100px;
  width: 100%;
  overflow: hidden;
  background: #fafaf8;
}
.card-viz svg {
  display: block;
}

.card-body {
  padding: 16px 20px 20px;
  flex: 1;
  display: flex;
  flex-direction: column;
}

.card-badge {
  display: inline-block;
  font-family: system-ui, -apple-system, sans-serif;
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  padding: 2px 8px;
  border-radius: 4px;
  margin-bottom: 8px;
  width: fit-content;
}

.card-title {
  font-family: system-ui, -apple-system, sans-serif;
  font-size: 1.05rem;
  font-weight: 700;
  margin-bottom: 6px;
  letter-spacing: -0.01em;
}

.card-question {
  font-family: Georgia, 'Times New Roman', serif;
  font-size: 0.88rem;
  color: #555;
  flex: 1;
  margin-bottom: 12px;
  font-style: italic;
}

.card-link {
  font-family: system-ui, -apple-system, sans-serif;
  font-size: 0.85rem;
  font-weight: 600;
  text-decoration: none;
  transition: gap 0.15s ease;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}
.card:hover .card-link {
  gap: 8px;
}

footer {
  text-align: center;
  padding: 32px 24px 48px;
  font-size: 0.85rem;
  color: #888;
  border-top: 1px solid #e5e5e0;
  max-width: 680px;
  margin: 0 auto;
}
</style>
</head>
<body>

<header>
  <h1>Symbioism: The Last Economy</h1>
  <p class="subtitle">Ten interactive chapters where you manipulate the ideas directly</p>
  <p class="prose intro">
    Since <span class="scrub" id="scrub-year" data-min="1750" data-max="2030" data-value="1750">1750</span>,
    civilization has reorganized its economic engine
    <span class="scrub" id="scrub-count" data-min="1" data-max="6" data-value="4">4</span> times.
    We are living through the <span id="ordinal">4th</span> transition now — and this one is different.
    Each prior shift — agrarian to mercantile, mercantile to industrial, industrial to informational —
    changed <em>what</em> humans did. This shift changes <em>whether</em> humans do it at all.
  </p>
</header>

<section class="grid-section">
  <div class="grid" id="card-grid"></div>
</section>

<footer>
  Self-contained HTML files. No server required. Works offline.
</footer>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
// --- Scrubable numbers ---
(function() {
  const ordinals = ['','1st','2nd','3rd','4th','5th','6th'];
  const ordinalEl = document.getElementById('ordinal');

  function updateOrdinal() {
    const v = parseInt(document.getElementById('scrub-count').dataset.value);
    ordinalEl.textContent = ordinals[v] || v + 'th';
  }

  document.querySelectorAll('.scrub').forEach(el => {
    let startX, startVal;
    const min = parseInt(el.dataset.min);
    const max = parseInt(el.dataset.max);
    const sensitivity = (max - min) > 100 ? 1 : 0.15;

    function onMove(clientX) {
      const dx = clientX - startX;
      let next = Math.round(startVal + dx * sensitivity);
      next = Math.max(min, Math.min(max, next));
      el.dataset.value = next;
      el.textContent = next;
      updateOrdinal();
    }

    el.addEventListener('mousedown', e => {
      e.preventDefault();
      startX = e.clientX;
      startVal = parseInt(el.dataset.value);
      const moveHandler = e2 => onMove(e2.clientX);
      const upHandler = () => {
        document.removeEventListener('mousemove', moveHandler);
        document.removeEventListener('mouseup', upHandler);
      };
      document.addEventListener('mousemove', moveHandler);
      document.addEventListener('mouseup', upHandler);
    });

    el.addEventListener('touchstart', e => {
      e.preventDefault();
      startX = e.touches[0].clientX;
      startVal = parseInt(el.dataset.value);
      const moveHandler = e2 => onMove(e2.touches[0].clientX);
      const upHandler = () => {
        document.removeEventListener('touchmove', moveHandler);
        document.removeEventListener('touchend', upHandler);
      };
      document.addEventListener('touchmove', moveHandler);
      document.addEventListener('touchend', upHandler);
    });
  });
})();

// --- Card data ---
const cards = [
  { n: 1,  file: '01-intelligence-inversion.html', title: 'The Intelligence Inversion', ch: 'Ch 1',   q: 'When cognition itself is automated, where do humans pivot?', color: '#7c3aed' },
  { n: 2,  file: '02-harbingers.html',              title: 'Harbingers of the Storm',    ch: 'Ch 2',   q: 'What does physics look like when a system is about to break?', color: '#dc2626' },
  { n: 3,  file: '03-gdp-illusion.html',            title: 'The GDP Illusion',           ch: 'Chs 3\u20134', q: 'What if your only instrument rewarded destruction?', color: '#d97706' },
  { n: 4,  file: '04-maxwells-demon.html',           title: 'Maxwell\u2019s Demon',              ch: 'Ch 6',   q: 'Is value a social agreement or a law of physics?', color: '#059669' },
  { n: 5,  file: '05-mind-dashboard.html',           title: 'The MIND Dashboard',         ch: 'Chs 7\u20138', q: 'What happens when any single dimension of civilization reaches zero?', color: '#2563eb' },
  { n: 6,  file: '06-three-flows.html',              title: 'The Three Flows',            ch: 'Ch 9',   q: 'Were Smith, Marx, and Hayek all right \u2014 looking at different parts of the same river?', color: '#0891b2' },
  { n: 7,  file: '07-network-prison.html',           title: 'The Network Prison',         ch: 'Ch 10',  q: 'Does individual talent matter, or only network position?', color: '#7c3aed' },
  { n: 8,  file: '08-cooperation-emerges.html',      title: 'Cooperation Emerges',        ch: 'Ch 12',  q: 'Is cooperation idealism \u2014 or the mathematically optimal selfish strategy?', color: '#16a34a' },
  { n: 9,  file: '09-three-futures.html',            title: 'The Three Futures',          ch: 'Chs 16+19', q: 'Which crystal will this supercooled civilization become?', color: '#dc2626' },
  { n: 10, file: '10-after-economics.html',          title: 'After Economics',            ch: 'Chs 20\u201321', q: 'AI unbundles the job. What do you replace each piece with?', color: '#7c3aed' },
];

// --- Mini-visualization generators ---
const vizGenerators = [
  // 1: Rising then flipping sigmoid (intelligence inversion)
  function(svg, w, h, color) {
    const n = 40;
    const data = d3.range(n).map(i => {
      const x = i / (n - 1);
      return { x, y: 1 / (1 + Math.exp(-12 * (x - 0.5))) };
    });
    const xS = d3.scaleLinear().domain([0, 1]).range([0, w]);
    const yS = d3.scaleLinear().domain([0, 1]).range([h - 8, 8]);
    const line = d3.line().x(d => xS(d.x)).y(d => yS(d.y)).curve(d3.curveBasis);
    svg.append('path').datum(data).attr('d', line).attr('fill', 'none')
      .attr('stroke', color).attr('stroke-width', 2).attr('opacity', 0.7)
      .attr('stroke-dasharray', function() { return this.getTotalLength(); })
      .attr('stroke-dashoffset', function() { return this.getTotalLength(); })
      .transition().duration(1500).attr('stroke-dashoffset', 0);
    // mirror line
    const data2 = data.map(d => ({ x: d.x, y: 1 - d.y }));
    svg.append('path').datum(data2).attr('d', line).attr('fill', 'none')
      .attr('stroke', color).attr('stroke-width', 2).attr('opacity', 0.25)
      .attr('stroke-dasharray', '4,4');
  },
  // 2: Seismograph jitter (harbingers)
  function(svg, w, h, color) {
    const n = 60;
    const data = d3.range(n).map(i => {
      const x = i / (n - 1);
      const amp = Math.pow(x, 2.5);
      return { x, y: 0.5 + amp * (Math.random() - 0.5) };
    });
    const xS = d3.scaleLinear().domain([0, 1]).range([4, w - 4]);
    const yS = d3.scaleLinear().domain([0, 1]).range([h - 8, 8]);
    const line = d3.line().x(d => xS(d.x)).y(d => yS(d.y)).curve(d3.curveLinear);
    svg.append('path').datum(data).attr('d', line).attr('fill', 'none')
      .attr('stroke', color).attr('stroke-width', 1.5).attr('opacity', 0.7)
      .attr('stroke-dasharray', function() { return this.getTotalLength(); })
      .attr('stroke-dashoffset', function() { return this.getTotalLength(); })
      .transition().duration(2000).attr('stroke-dashoffset', 0);
  },
  // 3: Diverging bars (GDP illusion)
  function(svg, w, h, color) {
    const n = 12;
    const barW = w / (n * 2);
    const data = d3.range(n).map(i => ({ i, v: 0.3 + Math.random() * 0.7, bad: Math.random() > 0.5 }));
    const xS = d3.scaleBand().domain(d3.range(n)).range([16, w - 16]).padding(0.35);
    const yS = d3.scaleLinear().domain([0, 1]).range([0, h * 0.65]);
    svg.selectAll('rect').data(data).join('rect')
      .attr('x', d => xS(d.i)).attr('width', xS.bandwidth())
      .attr('y', h - 10).attr('height', 0)
      .attr('rx', 2)
      .attr('fill', d => d.bad ? '#e5e5e0' : color).attr('opacity', d => d.bad ? 0.6 : 0.7)
      .transition().duration(800).delay((d, i) => i * 60)
      .attr('y', d => h - 10 - yS(d.v)).attr('height', d => yS(d.v));
  },
  // 4: Orbiting particles (Maxwell's Demon)
  function(svg, w, h, color) {
    const cx = w / 2, cy = h / 2, r = Math.min(w, h) * 0.32;
    svg.append('line').attr('x1', cx).attr('y1', 8).attr('x2', cx).attr('y2', h - 8)
      .attr('stroke', '#e5e5e0').attr('stroke-width', 1).attr('stroke-dasharray', '3,3');
    const particles = d3.range(14).map(() => ({
      angle: Math.random() * Math.PI * 2,
      speed: 0.005 + Math.random() * 0.015,
      rx: r * (0.5 + Math.random() * 0.5),
      ry: r * (0.3 + Math.random() * 0.5),
      side: Math.random() > 0.5
    }));
    const dots = svg.selectAll('circle').data(particles).join('circle')
      .attr('r', 3).attr('fill', d => d.side ? color : '#dc2626').attr('opacity', 0.65);
    function tick() {
      particles.forEach(p => p.angle += p.speed);
      dots.attr('cx', d => cx + Math.cos(d.angle) * d.rx)
          .attr('cy', d => cy + Math.sin(d.angle) * d.ry);
      requestAnimationFrame(tick);
    }
    tick();
  },
  // 5: Radar / pentagon (MIND Dashboard)
  function(svg, w, h, color) {
    const cx = w / 2, cy = h / 2, r = Math.min(w, h) * 0.35;
    const dims = 5;
    const angles = d3.range(dims).map(i => (i / dims) * Math.PI * 2 - Math.PI / 2);
    // grid
    [0.33, 0.66, 1].forEach(s => {
      const pts = angles.map(a => [cx + Math.cos(a) * r * s, cy + Math.sin(a) * r * s]);
      svg.append('polygon').attr('points', pts.map(p => p.join(',')).join(' '))
        .attr('fill', 'none').attr('stroke', '#e5e5e0').attr('stroke-width', 1);
    });
    const vals = [0.8, 0.6, 0.4, 0.9, 0.55];
    const pts = angles.map((a, i) => [cx + Math.cos(a) * r * vals[i], cy + Math.sin(a) * r * vals[i]]);
    svg.append('polygon').attr('points', pts.map(p => p.join(',')).join(' '))
      .attr('fill', color).attr('fill-opacity', 0.15).attr('stroke', color)
      .attr('stroke-width', 1.5).attr('opacity', 0)
      .transition().duration(800).attr('opacity', 1);
    svg.selectAll('.dot').data(pts).join('circle')
      .attr('cx', d => d[0]).attr('cy', d => d[1]).attr('r', 3)
      .attr('fill', color).attr('opacity', 0)
      .transition().duration(600).delay((d, i) => 800 + i * 100).attr('opacity', 1);
  },
  // 6: Three flowing streams (Three Flows)
  function(svg, w, h, color) {
    const colors = [color, '#7c3aed', '#d97706'];
    colors.forEach((c, idx) => {
      const n = 30;
      const offset = (idx - 1) * h * 0.25;
      const data = d3.range(n).map(i => {
        const x = i / (n - 1);
        return { x, y: 0.5 + offset / h + 0.12 * Math.sin(x * Math.PI * 3 + idx * 2) };
      });
      const xS = d3.scaleLinear().domain([0, 1]).range([0, w]);
      const yS = d3.scaleLinear().domain([0, 1]).range([4, h - 4]);
      const line = d3.line().x(d => xS(d.x)).y(d => yS(d.y)).curve(d3.curveBasis);
      svg.append('path').datum(data).attr('d', line).attr('fill', 'none')
        .attr('stroke', c).attr('stroke-width', 2).attr('opacity', 0.5)
        .attr('stroke-dasharray', function() { return this.getTotalLength(); })
        .attr('stroke-dashoffset', function() { return this.getTotalLength(); })
        .transition().duration(1500).delay(idx * 200).attr('stroke-dashoffset', 0);
    });
  },
  // 7: Network graph (Network Prison)
  function(svg, w, h, color) {
    const nodes = d3.range(10).map(i => ({
      x: 20 + Math.random() * (w - 40),
      y: 12 + Math.random() * (h - 24),
      r: i === 0 ? 6 : 3 + Math.random() * 2
    }));
    const edges = [];
    for (let i = 1; i < nodes.length; i++) {
      edges.push({ s: Math.floor(Math.random() * i), t: i });
      if (Math.random() > 0.5 && i > 2) edges.push({ s: Math.floor(Math.random() * i), t: i });
    }
    svg.selectAll('line').data(edges).join('line')
      .attr('x1', d => nodes[d.s].x).attr('y1', d => nodes[d.s].y)
      .attr('x2', d => nodes[d.t].x).attr('y2', d => nodes[d.t].y)
      .attr('stroke', '#d5d5d0').attr('stroke-width', 1);
    svg.selectAll('circle').data(nodes).join('circle')
      .attr('cx', d => d.x).attr('cy', d => d.y).attr('r', 0)
      .attr('fill', (d, i) => i === 0 ? color : '#aaa').attr('opacity', 0.7)
      .transition().duration(500).delay((d, i) => i * 80).attr('r', d => d.r);
  },
  // 8: Growing cooperation dots (Cooperation Emerges)
  function(svg, w, h, color) {
    const n = 24;
    const data = d3.range(n).map(i => ({
      x: 16 + Math.random() * (w - 32),
      y: 10 + Math.random() * (h - 20),
      cooperate: Math.random() > 0.4
    }));
    const dots = svg.selectAll('circle').data(data).join('circle')
      .attr('cx', d => d.x).attr('cy', d => d.y).attr('r', 0)
      .attr('fill', d => d.cooperate ? color : '#ddd').attr('opacity', 0.7)
      .transition().duration(600).delay((d, i) => i * 40).attr('r', 4);
    // animate defectors turning cooperative
    setTimeout(() => {
      svg.selectAll('circle')
        .transition().duration(1200)
        .attr('fill', color).attr('opacity', 0.65);
    }, 1800);
  },
  // 9: Three branching paths (Three Futures)
  function(svg, w, h, color) {
    const startX = 20, startY = h / 2;
    const branches = [
      { dy: -0.35, c: color },
      { dy: 0, c: '#666' },
      { dy: 0.35, c: '#059669' }
    ];
    branches.forEach((b, idx) => {
      const n = 20;
      const data = d3.range(n).map(i => {
        const t = i / (n - 1);
        return { x: startX + t * (w - 40), y: startY + b.dy * h * Math.pow(t, 1.5) };
      });
      const line = d3.line().x(d => d.x).y(d => d.y).curve(d3.curveBasis);
      svg.append('path').datum(data).attr('d', line).attr('fill', 'none')
        .attr('stroke', b.c).attr('stroke-width', 2).attr('opacity', 0.6)
        .attr('stroke-dasharray', function() { return this.getTotalLength(); })
        .attr('stroke-dashoffset', function() { return this.getTotalLength(); })
        .transition().duration(1200).delay(idx * 200).attr('stroke-dashoffset', 0);
    });
    svg.append('circle').attr('cx', startX).attr('cy', startY).attr('r', 4)
      .attr('fill', color).attr('opacity', 0.8);
  },
  // 10: Unbundling blocks (After Economics)
  function(svg, w, h, color) {
    const blockW = 14, gap = 4;
    const cols = Math.floor((w - 20) / (blockW + gap));
    const rows = 3;
    const offsetX = (w - cols * (blockW + gap) + gap) / 2;
    const offsetY = (h - rows * (blockW + gap) + gap) / 2;
    const data = [];
    for (let r = 0; r < rows; r++) {
      for (let c = 0; c < cols; c++) {
        data.push({ r, c, x: offsetX + c * (blockW + gap), y: offsetY + r * (blockW + gap) });
      }
    }
    const colors = [color, '#7c3aed', '#d97706', '#059669', '#dc2626'];
    svg.selectAll('rect').data(data).join('rect')
      .attr('x', w / 2).attr('y', h / 2).attr('width', 0).attr('height', 0)
      .attr('rx', 2).attr('fill', (d, i) => colors[i % colors.length]).attr('opacity', 0.55)
      .transition().duration(600).delay((d, i) => i * 25)
      .attr('x', d => d.x).attr('y', d => d.y)
      .attr('width', blockW).attr('height', blockW);
  }
];

// --- Build cards ---
const grid = document.getElementById('card-grid');

cards.forEach((card, idx) => {
  const a = document.createElement('a');
  a.href = card.file;
  a.className = 'card';

  // Accent bar
  const accent = document.createElement('div');
  accent.className = 'card-accent';
  accent.style.background = card.color;
  a.appendChild(accent);

  // Viz container
  const vizDiv = document.createElement('div');
  vizDiv.className = 'card-viz';
  vizDiv.id = 'viz-' + card.n;
  a.appendChild(vizDiv);

  // Body
  const body = document.createElement('div');
  body.className = 'card-body';

  const badge = document.createElement('span');
  badge.className = 'card-badge';
  badge.style.background = card.color + '14';
  badge.style.color = card.color;
  badge.textContent = card.ch;
  body.appendChild(badge);

  const title = document.createElement('div');
  title.className = 'card-title';
  title.textContent = card.title;
  body.appendChild(title);

  const question = document.createElement('div');
  question.className = 'card-question';
  question.textContent = card.q;
  body.appendChild(question);

  const link = document.createElement('span');
  link.className = 'card-link';
  link.style.color = card.color;
  link.textContent = 'Explore';
  link.insertAdjacentHTML('beforeend', ' <span style="transition:inherit">\u2192</span>');
  body.appendChild(link);

  a.appendChild(body);
  grid.appendChild(a);

  // Initialize D3 viz
  requestAnimationFrame(() => {
    const container = document.getElementById('viz-' + card.n);
    const w = container.clientWidth;
    const h = container.clientHeight;
    const svg = d3.select(container).append('svg')
      .attr('width', w).attr('height', h)
      .attr('viewBox', `0 0 ${w} ${h}`);
    vizGenerators[idx](svg, w, h, card.color);
  });
});
</script>
</body>
</html>
